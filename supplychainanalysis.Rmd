---
title: "Supply Chain Transparency Analysis"
output: html_notebook
---

### Data Setup and Import

```{r}
# Setting the correct working directory
setwd('C:\\Users\\Denis Bozic\\Desktop\\Data Practice\\Supply Chain Transparency')
```

We will start by importing the required .csv file containg data on the 60 companies as well as their supply chain transparency scores. 

```{r}
# Assigning the .csv data into a variable
initial_data <- read.csv('supplychaindata.csv')
```

### Structure Exploration

```{r}
# Exploring the columns and the first few rows:
head(initial_data)
```

```{r}
# Exploring the structure of the dataframe
str(initial_data)
```

There are specific rows that we won't need for this analysis, specifically the Size.Source and and Revenue.Source, since these were descriptions that I used for augmenting my thesis literature. For purposes of this analysis, however, they won't be that useful. Let's drop those rows now before proceeding to other parts of the analysis. 

```{r}
# Dropping the two columns by assigning NULL 
initial_data$Size.Source <- NULL
initial_data$Revenue.Source <- NULL
```

Let's check again for the presence of these columns:

```{r}
# Checking again for adjusted data
head(initial_data)
```

There are several factor variables, so let's explore levels of these:

```{r}
#Levels of Nationality 
levels(initial_data$Nationality)
```

```{r}
#Levels of Business Orientation
levels(initial_data$Business.Orientation)
```

```{r}
#Levels of Rank
levels(initial_data$Rank)
```

From structure exploration, we can notice two things:

* The size and revenue columns have 0 values, which represent missing data. These will have to be imputated. 
* The Nationality table is broken down into specific countries, along with some unclear categories (UK/Japan).We will have to fuse these into three major categories for easier analysis: USA, Europe, and Oceania.
* We should also convert all the 'Yes' to 1s and all the 'No' to 0s so that we can approximate these variables as binomial distributions with Bernoulli trials. 

### Data Cleanup

**Checking for incomplete information**

```{r}
# Let's find if there are any missing values
initial_data[!complete.cases(initial_data),]
```

We have two missing value for Scotch&Soda: NA for Size and 0 for Annual Revenue. Both of these will have to be imputated. However, there are also other rows with 0s in these columns, so we need to check for those as well.

```{r}
# Let's check for all places where we also have 0s
initial_data[initial_data$Size == 0 | initial_data$Annual.Revenue==0,]
```

There's a notable number of data points without information on either size or annual revenue. While we are operating with only 60 data points and median-based imputation is certainly not ideal, business orientation-based replacement should provide us with a reasonable proxy for these values. Business orientation, based on my research, generally provides an informative split between companies on size and revenue. 

So, let's understand the median for each category across size and revenue. We will start with size.

**Median: Size**

```{r}
# Extract the overall median of the dataframa with non-zero values in Size.
# We remember to include also the NA value for Scotch & Soda.

med_size <- median(initial_data[initial_data$Size != 0 & !is.na(initial_data$Size), "Size"])
med_size
```

The overall median size is 10,000 but we need to split these across the three business orientation categories. 

```{r}
# Median size for sustainability-oriented businesses
med_size_sus <- median(initial_data[initial_data$Size != 0 & !is.na(initial_data$Size) & 
                      initial_data$Business.Orientation == 'Sustainability-oriented' , "Size"])
med_size_sus

```

```{r}
# Median size for neutral businesses
med_size_neu <- median(initial_data[initial_data$Size != 0 & !is.na(initial_data$Size) & 
                      initial_data$Business.Orientation == 'Neutral' , "Size"])
med_size_neu

```

```{r}
# Median size for trend--oriented businesses
med_size_tre <- median(initial_data[initial_data$Size != 0 & !is.na(initial_data$Size) & 
                      initial_data$Business.Orientation == 'Trend-oriented' , "Size"])
med_size_tre

```


The overall median size is 10,000 employees, but these numbers differ notably for each business orientation category. Sustainability-oriented ones have a median of 75 people, neutral of 10,000 people (like the overall median), while the trend-oriented ones have a median of 16,000 people. 

Let's do the same for revenue across these three categories. 

**Median: Revenue**

```{r}
# Extract the overall median of the dataframa with non-zero values in Annual Revenue.

med_revenue <- median(initial_data[initial_data$Annual.Revenue != 0 & 
                                     !is.na(initial_data$Annual.Revenue), "Annual.Revenue"])
med_revenue
```

The overall annual revenue is $2,205,500,000. Now, let's look across different categories. 

```{r}
# Median annual revenue for sustainability-oriented businesses
med_revenue_sus <- median(initial_data[initial_data$Annual.Revenue != 0 & 
                      !is.na(initial_data$Annual.Revenue) & 
                      initial_data$Business.Orientation == 'Sustainability-oriented' , "Annual.Revenue"])
med_revenue_sus
```

```{r}
# Median annual revenue for neutral businesses
med_revenue_neu <- median(initial_data[initial_data$Annual.Revenue != 0 & 
                      !is.na(initial_data$Annual.Revenue) & 
                      initial_data$Business.Orientation == 'Neutral' , "Annual.Revenue"])
med_revenue_neu
```

```{r}
# Median annual revenue for trend-oriented businesses
med_revenue_tre <- median(initial_data[initial_data$Annual.Revenue != 0 & 
                      !is.na(initial_data$Annual.Revenue) & 
                      initial_data$Business.Orientation == 'Trend-oriented' , "Annual.Revenue"])
med_revenue_tre
```

Now we will imputate all the required missing values with their respective medians. 

**Imputation: Size**

```{r}
# Imputating size for sustainability brands
initial_data[initial_data$Business.Orientation == "Sustainability-oriented" & 
               initial_data$Size == 0,"Size"] <- med_size_sus
initial_data[initial_data$Business.Orientation == 'Sustainability-oriented',]
```

```{r}
# Imputating size for neutral brands
initial_data[initial_data$Business.Orientation == "Neutral" & 
               initial_data$Size == 0,"Size"] <- med_size_neu
initial_data[initial_data$Business.Orientation == 'Neutral',]
```

```{r}
# Imputating size for trend-oriented brands
initial_data[initial_data$Business.Orientation == "Trend-oriented" & 
               is.na(initial_data$Size),"Size"] <- med_size_tre
initial_data[initial_data$Business.Orientation == 'Trend-oriented',]
```

```{r}
# Let's check how the dataset looks now.
initial_data
```

**Imputation: Annual Revenue**

```{r}
# Imputating revenue for sustainability brands
initial_data[initial_data$Business.Orientation == "Sustainability-oriented" & 
               initial_data$Annual.Revenue == 0,"Annual.Revenue"] <- med_revenue_sus
initial_data[initial_data$Business.Orientation == 'Sustainability-oriented',]
```

```{r}
# Imputating revenue for neutral brands
initial_data[initial_data$Business.Orientation == "Neutral" & 
               initial_data$Annual.Revenue == 0,"Annual.Revenue"] <- med_revenue_neu
initial_data[initial_data$Business.Orientation == 'Neutral',]
```

```{r}
# Imputating revenue for trend-oriented brands
initial_data[initial_data$Business.Orientation == "Trend-oriented" & 
               initial_data$Annual.Revenue == 0,"Annual.Revenue"] <- med_revenue_tre
initial_data[initial_data$Business.Orientation == 'Trend-oriented',]
```

```{r}
# Let's check how the dataset looks now.
initial_data
```

**Transforming into binomial-like variable**

Now, let's convert all the "Yes" to 1, and all the "No" to 0s for easier analysis. To make things easier, we will first need to change all factors to characters. Let's define a function for that:

```{r}
# Defining the unfactorize function

unfactorize <- function(data){
  for(i in which(sapply(data, class) == "factor")){
    data[[i]] = as.character(data[[i]])
  }
  return(data)
}
```

```{r}
# Unfactorizing the data and storing in a new variable

unfactorized_data <- unfactorize(initial_data)
unfactorized_data
```

```{r}
# Transforming into binomial distribution
unfactorized_data[unfactorized_data == "Yes"] <- 1
unfactorized_data[unfactorized_data == "No"] <- 0
unfactorized_data
```

We need to be aware these are character variables now. 

**Clustering nationality variable**

```{r}

# We will first rename all instances of Australia and New Zealand to Oceania
unfactorized_data[unfactorized_data$Nationality == 'Australia' |
                    unfactorized_data$Nationality == 'New Zealand', "Nationality"] <- "Oceania"

# Then we take a reverse approach, and convert all non-US and non-Oceania entires to Europe
unfactorized_data[unfactorized_data$Nationality != 'USA' &
                    unfactorized_data$Nationality != 'Oceania', "Nationality"] <- "Europe"

unfactorized_data

```

**Transforming back variables to their desired states**

*Transforming numeric-based characters to numeric*

```{r}
#Let's also transform all the numeric-based character data into actual numeric data
unfactorized_data[,c(5,6,7,8,9,11)] <- as.numeric(unlist(unfactorized_data[,c(5,6,7,8,9,11)]))
unfactorized_data
```

*Transforming character variables back to factors*

```{r}
# We will first define a reverse function of unfactorized

factorize <- function(data){
  for(i in which(sapply(data, class) == "character")){
    data[[i]] = as.factor(data[[i]])
  }
  return(data)
}
```

```{r}
# Putting everything into a final data frame through factorize function

data <- factorize(unfactorized_data)
data
```

We are now finally ready to proceed with visualizing and analyzing data. 

### Data Exploration

In this section, I perform some of the basic data exploration by visualizing relationships between variables. 

**Size vs. Revenue across Business Orientation, Nationality, and Transparency Rank**

```{r}
#Loading the ggplot2 library
library(ggplot2)
```

```{r}
#Scatter against Business Orientation - original
scatter1 <- ggplot(data, aes(x=Size, y=Annual.Revenue)) + 
            geom_point(aes(colour=Business.Orientation)) +
            ggtitle("Size and Annual Revenue versus Business Orientation") +
            theme_minimal() +
            theme(plot.title=element_text( hjust=0.5, vjust=0.8, face='bold'))
scatter1
```

We can certainly notice two clear observations:

* If we imagine a regression line passing through, the heteroescadastic-like behavior of data points shows that a non-linear relationship between these two variables is more likely.

* Even without any statistical transformation, neutral—and more notably the trend-oriented companies are the ones with greater number of employees and greater revenue. Albeit not surprising, it is somewhat of a good validation of the quality of collected data. 

Let's try transforming the revenue data to a logarithmic scale and see what we get. 


```{r}
#Scatter against Business Orientation

scatter2 <- ggplot(data, aes(x=Size, y=log(Annual.Revenue))) + 
            ggtitle("Size and log(Annual Revenue) versus Business Orientation") +
            geom_point(aes(colour=Business.Orientation)) +
            theme_minimal() +
            theme(plot.title=element_text( hjust=0.5, vjust=0.8, face='bold'))
scatter2
```

Now, we can observe a clearer relationship between the size of the company and the logarithmic scale of annual revenue. The relationship is not linear, and resembles a logarithmic rise, but it shows clearly that, as the size and revenue increase for a company, the business orientation changes from sustainability-oriented to neutral and to trend-oriented, denoting that companies focused on sustainability tend to be much smaller and likely less scalable. 

We can also compare this relationship by looking at size and revenue across continents.

```{r}
#Scatter against Nationality

scatter3 <- ggplot(data, aes(x=Size, y=log(Annual.Revenue))) + 
            geom_point(aes(colour=Nationality)) +
            ggtitle("Size and log(Annual Revenue) versus Nationality") +
            scale_color_manual(values=c("#E69F00", "#ff00ff", "#006600")) + 
            theme_minimal() +
            theme(plot.title=element_text( hjust=0.5, vjust=0.8, face='bold'))
scatter3

```

Since companies from Oceania are not largely present in the dataset, it is most useful to compare US and European companies across this dataset. What is most notable is that European companies tend to dominate the space of the graph with large size and revenues (trend-oriented companies as seen in previous graph), while US companies tend to dominate the space with lower size and revenue (sustainability-oriented companies). 

Finally, we can also use this scatter plot to visualize the relationship across the transparency scores: low, medium, high. 

```{r}
#Scatter against Rank

scatter4 <- ggplot(data, aes(x=Size, y=log(Annual.Revenue))) + 
            geom_point(aes(colour=Rank)) +
            ggtitle("Size and log(Annual Revenue) versus Transparency Rank") +
            scale_color_manual(values=c("#009900", "#ff0000", "#ff9900")) +
            theme_minimal() +
            theme(plot.title=element_text( hjust=0.5, vjust=0.8, face='bold'))
scatter4
```

My hypothesis was that companies with a large number of employees and annual revenue would score lowest on the supply chain transparency ranking criteria, but as can be seen from the scatter plot, those companies tend to be of medium transparency.

Instead, low-transparency companies exist in the space with lower size and lower revenue. Since the criteria for ranking was based on external transparency, this could be because larger companies tend to face more public pressure to publish certain information, such as list of suppliers or their code of conduct. 

**Supply chain transparency ranking across business orientation and nationality**

If we switch gears now, we can look at how supply chain transparency rank compares across different critera. This was partially visible from the previous scatter plots, but we can also visualize the relationship through simple bar charts. Let's take a look at the transparency rank scores across business orientation. 

```{r}

# Loading forcats package

library(forcats)

# Countplot against business orientation

count1 <- ggplot(data, aes(x=fct_infreq(Rank))) + 
          geom_bar(aes(fill=Business.Orientation), width=0.3) +
          ggtitle("Transparency Rank versus Business Orientation") +
          xlab(" Transparency Rank") +
          ylab("Number of companies") +
          theme_minimal() +
          theme(plot.title=element_text( hjust=0.5, vjust=0.8, face='bold'))
count1
```

The most interesting category is that of sustainability-oriented businesses: although they are the ones that constitute the majority of the high-ranking companies in terms of transparency, they are also the ones that take up a large percentage of companies with low transparency. This was an interesting finding for my graduate research because it showed that, despite many efforts of sustainability-oriented businesses, many of them score low on external transparency. My hypothesis, which I later investigated and confirmed through legal research, was that they simply do not face enough public pressure from external stakeholders. 

I also wanted to see if there were any interesting differences across different continents when it came to supply chain transparency. 

```{r}

# Countplot against nationality

count2 <- ggplot(data, aes(x=fct_infreq(Rank))) + 
          geom_bar(aes(fill=Nationality), width=0.3) +
          scale_fill_manual(values=c("Europe" = "#E69F00", "Oceania"= "#ff00ff", "USA"= "#006600")) +
          ggtitle("Transparency Rank versus Nationality") +
          xlab("Transparency Rank") +
          ylab("Number of companies") +
          theme_minimal() +
          theme(plot.title=element_text( hjust=0.5, vjust=0.8, face='bold'))
count2
```

This bar graph shows that there doesn't seem to be any notable difference across the continents in terms of rank distribution. We can see that one of the earlier observations is confirmed: according to my ranking methodology, a larger percentage of high-ranking companies corresponds to US-based firms. This, of course, can only be extrapolated through a notably small sample in this dataset as there are very few high-ranking companies. 

**Publishing criteria across the three transparency ranks**

It would also be interesting to see how the three levels of transparency rank across the five publishing criteria. Before doing so, let's see which companies belong to each of the three categories.

```{r}
#High
data[data$Rank=="High",]
```

```{r}
#Medium
data[data$Rank=="Medium",]
```

```{r}
#Low
data[data$Rank=="Low",]
```

Before I rename them for processing purposes they are:

* Suppliers: does the brand publish a list of their suppliers online?

* Code of Conduct (CoC): does the brand publish a supplier code of conduct online?

* Audits: does the brand publish its supplier audits online? 

* Full-cost breakdown (FCB): does the brand publish a full-cost breakdown of its products online?

* Purchasing practices (PP): does the brand publish a list of purchasing practices online?

```{r}

#Subsetting the dataframe
criteria <- data[, c(5,6,7,8,9,12)]

#Simplifying the column names
colnames(criteria) <- c("Suppliers", "CoC", "Audits", "FCB", "PP", "Rank")

#Calling the new dataframe
criteria
```

```{r}
# Calling the advanced data manipulation packages
library(tidyr)
library(dplyr)
```

```{r}
# Now we need to count how many times we see "1"s in the columns for publishing criteria

criteria %>%
  select(Suppliers, CoC, Audits, FCB, PP, Rank) %>%
  gather(key, value, Suppliers:PP) %>%
  filter(value == 1) %>%
  ggplot(aes(fct_infreq(key)), ..count..) +
  geom_bar(width=0.3, aes(fill=Rank)) +
  scale_fill_manual(values=c("#009900", "#ff0000", "#ff9900")) +
  ggtitle("Publishing Criteria versus Transparency Rank") +
  xlab("Publishing criteria") +
  ylab("Number of companies") +
  theme_minimal() +
  theme(plot.title=element_text( hjust=0.5, vjust=0.8, face='bold'))

```

The chart shows few interesting findings:

* In general, most brands publish their purchasing practices. Conversely, full-cost breakdown is the category with the least number of brands as only a few of them publish their full-cost breakdown. Those brands, at the time of data collection, were:

```{r}
data[data$Full.cost.breakdown.published.==1,]
```

* Most brands do not publish their audits either. Those brands that did so at the time of data collection were:

```{r}
data[data$Audits.published.==1,]
```

* Low-ranking brands in this dataset only publish their list of suppliers and their purchasing practices. Interestingly, none of the high-ranking brands have published their full-cost breakdown. 


**Statistical Analysis of Transparency Score**

Finally, the last question is: are the three models of business orientation: sustainability-oriented, neutral, and trend-oriented truly different in terms of their transparency score? For this analysis, I wanted to implement ANOVA and detect if the difference between their mean scores was statistically significant. Given the low number of data points in this dataset, my hypothesis was that ANOVA would produce p-value higher than 0.05, thus signaling there is no evidence to conclude the groups are statistically different. 

Before doing so, I thought it would be worth listing companies across their business orientations.

```{r}
#Sustainability-oriented
data[data$Business.Orientation=="Sustainability-oriented",]
```

```{r}
#Neutral
data[data$Business.Orientation=="Neutral",]
```

```{r}
#Trend-oriented
data[data$Business.Orientation=="Trend-oriented",]
```

Let's define a new dataframe only with the required columns:

```{r}
#Extracting a new dataframe

anova_data <- data[,c(10,11)]
anova_data
```

```{r}
# Checking order of the Business Orientation levels
levels(anova_data$Business.Orientation)
```

```{r}
# Let's reorder them

anova_data$Business.Orientation <- ordered(anova_data$Business.Orientation,
                          levels = c("Sustainability-oriented", "Neutral", "Trend-oriented"))
levels(anova_data$Business.Orientation)
```

```{r}
# Let's compute summary statistics by Busines Orientation group

group_by(anova_data, Business.Orientation) %>%
  summarise(
    count = n(),
    mean = mean(Score),
    st_dev = sd(Score)
  )
```

```{r}
# Let's visualize these statistics throught box-plots

boxplot1 <- ggplot(anova_data, aes(x=Business.Orientation, y=Score, colour=Business.Orientation)) +
           ggtitle("Score and Business Orientation Boxplots") +
           geom_jitter() +
           geom_boxplot(size=1, alpha=0.5) +
           theme_minimal() +
           theme(plot.title=element_text( hjust=0.5, vjust=0.8, face='bold'))
boxplot1        
```

Given the few discrete values of transparency scores, it is clear that the boxplots also become less informative. For example, for neutral and trend-oriented companies, the median climbs up to the top of the box, and trend-oriented boxplot is missing a lower whisker, as the minimum observed value is 1 and at least 25% of the values are 1. At the same time, the boxplots show that, given the low volume of datapoints in this case, we are unlikely to observe a statistically significant difference in means between these three categories. 

We can also visualie this relationship through the mean-standard error graph.

```{r}
# Mean-with-SE plot
library(ggpubr)
ggline(anova_data, x = "Business.Orientation", y = "Score", 
       add = c("mean_se", "jitter"), 
       order = c("Sustainability-oriented", "Neutral", "Trend-oriented"),
       ylab = "Score", xlab = "Business.Orientation")
```

Interestingly, we can see that the mean does slightly increase in terms of score as we move from sustainability-oriented to trend-oriented, indicating improvement in transparency. We can also notice a decrease in standard error as we move from sustainability-oriented to trend-oriented. These differences are still unlikely to be significant, but let's check ANOVA either way. 

```{r}
# ANOVA analysis
anova <- aov(Score ~ Business.Orientation, data = anova_data)
# Summary of the analysis
summary(anova)
```

What this shows, essentially, is that we cannot reject the null-hypothesis, which states that the mean scores of these three groups are the same. Of course, I'd argue that we would be likely to observe a different truth in reality with a greater number of data points and a more granular scoring methodology. Furthermore, since the dataset was built through a qualitative and manual data collection, it's possible that some of the information in the dataset is incomplete, and that the scores are indeed different.  
